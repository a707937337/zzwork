<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">
	
	<sqlMap namespace="attendanceCount">
	  <typeAlias alias="attendanceCount" type="com.zz91.zzwork.desktop.domain.hr.AttendanceCount"/>
	   <resultMap class="attendanceCount" id="attendanceCountResult">
	    <result property="id" column="id"/>
	    <result property="name" column="name"/>
	    <result property="code" column="code"/>
	    <result property="punch0" column="punch0"/>
	    <result property="punch20" column="punch0"/>
	    <result property="punch60" column="punch0"/>
	    <result property="punch80" column="punch0"/>
	    <result property="punchCount" column="punch_count"/>
	    <result property="gmtWork" column="gmt_work"/>
	    <result property="gmtCreated" column="gmt_created"/>
	    <result property="gmtModeified" column="gmt_modeified"/>
	   </resultMap>
	   <sql id="filed">
	   name,
	   code,
	   punch0,
	   punch20,
	   punch60,
	   punch80,
	   punch_count,
	   gmt_work
	   </sql>
	   <sql id="query_Condition">
	   <dynamic prepend="where">
	   <isNotEmpty property="name" prepend="and">
	     name=#name#
	   </isNotEmpty>
	   <isNotEmpty property="gmt_work" prepend="and">
	     gmt_work=#gmt_work#
	   </isNotEmpty>
	   </dynamic>
	   </sql>
	  <select id="selectAttendanceCount" parameterClass="java.util.Map" resultClass="attendanceCountResult">
	    select
	    <include refid="filed"/>
	    from attendanceCode
	    <include refid="query_Condition"/>
	    <include refid="common.pageOrderBy"/>
	    <include refid="common.pageLimit"/>
	  </select>
	  
	  <select id="countByNameAndDate" parameterClass="java.util.Map" resultClass="attendanceCountResult">
	    select
	    <include refid="filed"/>
	    from attendanceCount where name = #name# and gmt_work = #gmtWork#
	  </select>
	  
	  <insert id="addAttendanceCount" parameterClass="attendanceCount">
	   insert into attendanceCount
	   (
	   name,
	   code,
	   punch0,
	   punch20,
	   punch60,
	   punch80,
	   punch_count,
	   gmt_work,
	   gmt_created,
	   gmt_modeified
	   )
	   values
	   (
	   #name#,
	   #code#,
	   #punch0#,
	   #punch20#,
	   #punch80#,
	   #punch_count#,
	   #gmtWork#,
	    now,
	    now 
	   )
	   <selectKey keyProperty="id" resultClass="java.lang.Integer">
	   select last_insert_id()
	   </selectKey>
	  </insert>
	</sqlMap>